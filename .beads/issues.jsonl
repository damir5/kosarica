{"id":"main-4mn","title":"Price Tracking DB Schema \u0026 Ingestion Pipeline","description":"Add grocery price tracking with chains, stores, retailer items, and prices. Pipeline runnable from CLI and Cloudflare Workers with Queue fanout. Covers 11 retail chains with CSV/XML/XLSX parsing.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T19:43:40.877298+01:00","created_by":"damir","updated_at":"2025-12-29T19:43:40.877298+01:00"}
{"id":"main-4mn.1","title":"Add price tracking tables to schema.ts","description":"Add 14 new tables to src/db/schema.ts:\n- Retail World: chains, stores, store_identifiers, retailer_items, retailer_item_barcodes\n- Canonical Catalog: products, product_aliases, product_links, product_relations\n- Prices: store_item_state, store_item_price_periods\n- Ingestion: ingestion_runs, ingestion_files, ingestion_file_entries, ingestion_errors\n\nKey features:\n- chains: text PK slug (konzum, lidl, etc.)\n- store_identifiers: handle filename codes, portal IDs\n- retailer_item_barcodes: many-to-one for Lidl case\n- store_item_state: price_signature for dedup\n- store_item_price_periods: history only on change","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T19:44:02.541685+01:00","created_by":"damir","updated_at":"2025-12-30T11:31:42.309531329Z","closed_at":"2025-12-30T11:31:42.309531329Z","close_reason":"Added 15 tables to schema.ts","labels":["phase1","schema"],"dependencies":[{"issue_id":"main-4mn.1","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:44:02.54488+01:00","created_by":"daemon"},{"issue_id":"main-4mn.1","depends_on_id":"main-4mn.34","type":"blocks","created_at":"2025-12-29T19:48:20.860347+01:00","created_by":"daemon"}]}
{"id":"main-4mn.10","title":"Create XLSX parser","description":"Create src/ingestion/parsers/xlsx.ts:\n- Use xlsx library\n- Handle DM national file format\n- Map columns to NormalizedRow","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:03.129997+01:00","created_by":"damir","updated_at":"2025-12-30T14:26:04.343217332Z","closed_at":"2025-12-30T14:26:04.343217332Z","close_reason":"Created src/ingestion/parsers/xlsx.ts with XlsxParser class extending base Parser. Features: column mapping via XlsxColumnMapping interface, sheet selection, Excel date/number handling, header detection utilities. Exports createXlsxParser, detectXlsxHeaders, and getXlsxSheetNames helper functions.","labels":["parsers","phase3"],"dependencies":[{"issue_id":"main-4mn.10","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:03.132137+01:00","created_by":"daemon"},{"issue_id":"main-4mn.10","depends_on_id":"main-4mn.7","type":"blocks","created_at":"2025-12-29T19:48:01.295495+01:00","created_by":"daemon"}]}
{"id":"main-4mn.11","title":"Create chain adapter registry","description":"Create src/ingestion/chains/index.ts:\n- Registry mapping chain_id → adapter\n- Chain config (URLs, formats, delimiters)\n- getAdapter(chain_id) function","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:28.501618+01:00","created_by":"damir","updated_at":"2025-12-30T14:21:12.591187838Z","closed_at":"2025-12-30T14:21:12.591187838Z","close_reason":"Closed","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.11","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:28.503709+01:00","created_by":"daemon"},{"issue_id":"main-4mn.11","depends_on_id":"main-4mn.3","type":"blocks","created_at":"2025-12-29T19:48:03.147307+01:00","created_by":"daemon"},{"issue_id":"main-4mn.11","depends_on_id":"main-4mn.7","type":"blocks","created_at":"2025-12-29T19:48:03.182901+01:00","created_by":"daemon"}]}
{"id":"main-4mn.12","title":"Implement Konzum chain adapter","description":"Create src/ingestion/chains/konzum.ts:\n- Format: CSV, delimiter: comma\n- Store resolution: filename (address + store ID)\n- Column mapping specific to Konzum format","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:29.343418+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:29.343418+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.12","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:29.345437+01:00","created_by":"daemon"},{"issue_id":"main-4mn.12","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.388851+01:00","created_by":"daemon"}]}
{"id":"main-4mn.13","title":"Implement Lidl chain adapter","description":"Create src/ingestion/chains/lidl.ts:\n- Format: CSV, delimiter: comma\n- Store resolution: filename (daily ZIP → fanout)\n- Handle multiple GTINs per SKU\n- Column mapping specific to Lidl format","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:31.90735+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:31.90735+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.13","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:31.909688+01:00","created_by":"daemon"},{"issue_id":"main-4mn.13","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.430367+01:00","created_by":"daemon"}]}
{"id":"main-4mn.14","title":"Implement Plodine chain adapter","description":"Create src/ingestion/chains/plodine.ts:\n- Format: CSV, delimiter: semicolon\n- Store resolution: filename\n- Handle ,69 decimal format (missing leading zero)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:32.78086+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:32.78086+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.14","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:32.783305+01:00","created_by":"daemon"},{"issue_id":"main-4mn.14","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.467815+01:00","created_by":"daemon"}]}
{"id":"main-4mn.15","title":"Implement Interspar chain adapter","description":"Create src/ingestion/chains/interspar.ts:\n- Format: CSV, delimiter: semicolon\n- Store resolution: filename","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:34.198416+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:34.198416+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.15","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:34.201028+01:00","created_by":"daemon"},{"issue_id":"main-4mn.15","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.502637+01:00","created_by":"daemon"}]}
{"id":"main-4mn.16","title":"Implement Studenac chain adapter","description":"Create src/ingestion/chains/studenac.ts:\n- Format: XML\n- Store resolution: XML content (store block inside)\n- Parse store info from within XML structure","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:35.136978+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:35.136978+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.16","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:35.139865+01:00","created_by":"daemon"},{"issue_id":"main-4mn.16","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.536656+01:00","created_by":"daemon"}]}
{"id":"main-4mn.17","title":"Implement Kaufland chain adapter","description":"Create src/ingestion/chains/kaufland.ts:\n- Format: CSV, delimiter: tab\n- Store resolution: filename","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:47.687201+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:47.687201+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.17","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:47.689059+01:00","created_by":"daemon"},{"issue_id":"main-4mn.17","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.571112+01:00","created_by":"daemon"}]}
{"id":"main-4mn.18","title":"Implement Eurospin chain adapter","description":"Create src/ingestion/chains/eurospin.ts:\n- Format: CSV, delimiter: semicolon\n- Store resolution: filename","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:49.052502+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:49.052502+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.18","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:49.054628+01:00","created_by":"daemon"},{"issue_id":"main-4mn.18","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.60454+01:00","created_by":"daemon"}]}
{"id":"main-4mn.19","title":"Implement DM chain adapter","description":"Create src/ingestion/chains/dm.ts:\n- Format: XLSX\n- Store resolution: single national file (all stores)\n- Parse Excel structure","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:50.30759+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:50.30759+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.19","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:50.30982+01:00","created_by":"daemon"},{"issue_id":"main-4mn.19","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.639809+01:00","created_by":"daemon"}]}
{"id":"main-4mn.2","title":"Generate Drizzle migration for price tracking","description":"Run drizzle-kit generate to create migration for the new price tracking tables.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T19:44:03.982069+01:00","created_by":"damir","updated_at":"2025-12-30T12:02:34.076178986Z","closed_at":"2025-12-30T12:02:34.076178986Z","close_reason":"Migration already generated in drizzle/0002_clean_magdalene.sql","labels":["phase1","schema"],"dependencies":[{"issue_id":"main-4mn.2","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:44:03.985166+01:00","created_by":"daemon"},{"issue_id":"main-4mn.2","depends_on_id":"main-4mn.1","type":"blocks","created_at":"2025-12-29T19:47:47.748724+01:00","created_by":"daemon"}]}
{"id":"main-4mn.20","title":"Implement KTC chain adapter","description":"Create src/ingestion/chains/ktc.ts:\n- Format: CSV, delimiter: semicolon\n- Store resolution: filename","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:51.350841+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:51.350841+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.20","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:51.353314+01:00","created_by":"daemon"},{"issue_id":"main-4mn.20","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.674216+01:00","created_by":"daemon"}]}
{"id":"main-4mn.21","title":"Implement Metro chain adapter","description":"Create src/ingestion/chains/metro.ts:\n- Format: CSV, delimiter: comma\n- Store resolution: filename","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:52.52463+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:52.52463+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.21","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:52.526794+01:00","created_by":"daemon"},{"issue_id":"main-4mn.21","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.70854+01:00","created_by":"daemon"}]}
{"id":"main-4mn.22","title":"Implement Trgocentar chain adapter","description":"Create src/ingestion/chains/trgocentar.ts:\n- Format: XML\n- Store resolution: filename + XML\n- Parse XML structure","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:45:54.365347+01:00","created_by":"damir","updated_at":"2025-12-29T19:45:54.365347+01:00","labels":["chains","phase4"],"dependencies":[{"issue_id":"main-4mn.22","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:45:54.367923+01:00","created_by":"daemon"},{"issue_id":"main-4mn.22","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:04.743861+01:00","created_by":"daemon"}]}
{"id":"main-4mn.23","title":"Create discover CLI command","description":"Create src/ingestion/cli/discover.ts:\n- List artifacts for chain+date\n- Usage: npx tsx src/ingestion/cli/discover.ts -c konzum -d 2025-12-29\n- Return URLs or paths of available files","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:46:19.177629+01:00","created_by":"damir","updated_at":"2025-12-29T19:46:19.177629+01:00","labels":["cli","phase5"],"dependencies":[{"issue_id":"main-4mn.23","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:46:19.17971+01:00","created_by":"daemon"},{"issue_id":"main-4mn.23","depends_on_id":"main-4mn.6","type":"blocks","created_at":"2025-12-29T19:48:15.256344+01:00","created_by":"daemon"},{"issue_id":"main-4mn.23","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:15.291579+01:00","created_by":"daemon"}]}
{"id":"main-4mn.24","title":"Create fetch CLI command","description":"Create src/ingestion/cli/fetch.ts:\n- Download + record ingestion_files\n- Usage: npx tsx src/ingestion/cli/fetch.ts -c konzum -u \u003curl_or_path\u003e\n- Store to R2/FS, compute SHA256","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:46:20.295853+01:00","created_by":"damir","updated_at":"2025-12-29T19:46:20.295853+01:00","labels":["cli","phase5"],"dependencies":[{"issue_id":"main-4mn.24","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:46:20.298066+01:00","created_by":"daemon"},{"issue_id":"main-4mn.24","depends_on_id":"main-4mn.6","type":"blocks","created_at":"2025-12-29T19:48:15.325642+01:00","created_by":"daemon"},{"issue_id":"main-4mn.24","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:15.359249+01:00","created_by":"daemon"}]}
{"id":"main-4mn.25","title":"Create expand CLI command","description":"Create src/ingestion/cli/expand.ts:\n- ZIP → entries\n- Usage: npx tsx src/ingestion/cli/expand.ts -f ingestion_file_id\n- Record ingestion_file_entries","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:46:21.302574+01:00","created_by":"damir","updated_at":"2025-12-29T19:46:21.302574+01:00","labels":["cli","phase5"],"dependencies":[{"issue_id":"main-4mn.25","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:46:21.305192+01:00","created_by":"daemon"},{"issue_id":"main-4mn.25","depends_on_id":"main-4mn.6","type":"blocks","created_at":"2025-12-29T19:48:15.393621+01:00","created_by":"daemon"},{"issue_id":"main-4mn.25","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:15.428546+01:00","created_by":"daemon"}]}
{"id":"main-4mn.26","title":"Create parse CLI command","description":"Create src/ingestion/cli/parse.ts:\n- Parse one file/entry\n- Usage: npx tsx src/ingestion/cli/parse.ts -c konzum -f \u003cpath\u003e\n- Use appropriate parser (CSV/XML/XLSX)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:46:22.700953+01:00","created_by":"damir","updated_at":"2025-12-29T19:46:22.700953+01:00","labels":["cli","phase5"],"dependencies":[{"issue_id":"main-4mn.26","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:46:22.703375+01:00","created_by":"daemon"},{"issue_id":"main-4mn.26","depends_on_id":"main-4mn.6","type":"blocks","created_at":"2025-12-29T19:48:15.462037+01:00","created_by":"daemon"},{"issue_id":"main-4mn.26","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:15.495373+01:00","created_by":"daemon"}]}
{"id":"main-4mn.27","title":"Create run CLI command (end-to-end)","description":"Create src/ingestion/cli/run.ts:\n- End-to-end for chain/date\n- Usage: npx tsx src/ingestion/cli/run.ts -c konzum -d 2025-12-29 [--store \u003cstore_id\u003e]\n- Support --dry-run flag\n- Orchestrate discover → fetch → expand → parse → persist","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:46:24.87748+01:00","created_by":"damir","updated_at":"2025-12-29T19:46:24.87748+01:00","labels":["cli","phase5"],"dependencies":[{"issue_id":"main-4mn.27","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:46:24.880002+01:00","created_by":"daemon"},{"issue_id":"main-4mn.27","depends_on_id":"main-4mn.6","type":"blocks","created_at":"2025-12-29T19:48:15.52855+01:00","created_by":"daemon"},{"issue_id":"main-4mn.27","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:15.561245+01:00","created_by":"daemon"}]}
{"id":"main-4mn.28","title":"Test each chain with sample data","description":"Test each chain adapter with sample data from ../data/sample/:\n- Verify parsing of all 11 chains\n- Check column mapping correctness\n- Validate NormalizedRow output","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:46:45.95908+01:00","created_by":"damir","updated_at":"2025-12-29T19:46:45.95908+01:00","labels":["phase6","testing"],"dependencies":[{"issue_id":"main-4mn.28","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:46:45.962074+01:00","created_by":"daemon"},{"issue_id":"main-4mn.28","depends_on_id":"main-4mn.27","type":"blocks","created_at":"2025-12-29T19:48:16.934603+01:00","created_by":"daemon"}]}
{"id":"main-4mn.29","title":"Verify price signature deduplication","description":"Test price_signature dedup logic:\n- Run same data twice\n- Verify no duplicate price_periods created\n- Verify last_seen_ts updated on second run\n- Verify new period created only on actual change","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:46:47.576289+01:00","created_by":"damir","updated_at":"2025-12-29T19:46:47.576289+01:00","labels":["phase6","testing"],"dependencies":[{"issue_id":"main-4mn.29","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:46:47.578468+01:00","created_by":"daemon"},{"issue_id":"main-4mn.29","depends_on_id":"main-4mn.27","type":"blocks","created_at":"2025-12-29T19:48:16.96941+01:00","created_by":"daemon"}]}
{"id":"main-4mn.3","title":"Create ingestion core types","description":"Create src/ingestion/core/types.ts with shared interfaces:\n- NormalizedRow: parsed row with prices, barcodes, quantities\n- StoreDescriptor: resolved store info\n- ChainAdapter interface\n- QueueMessage types for Cloudflare","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:44:28.391652+01:00","created_by":"damir","updated_at":"2025-12-30T12:05:40.753171105Z","closed_at":"2025-12-30T12:05:40.753171105Z","close_reason":"Created src/ingestion/core/types.ts with NormalizedRow, StoreDescriptor, ChainAdapter interface, and QueueMessage types for Cloudflare Workers","labels":["core","phase2"],"dependencies":[{"issue_id":"main-4mn.3","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:44:28.393798+01:00","created_by":"daemon"},{"issue_id":"main-4mn.3","depends_on_id":"main-4mn.1","type":"blocks","created_at":"2025-12-29T19:47:50.078824+01:00","created_by":"daemon"}]}
{"id":"main-4mn.30","title":"Verify store resolution","description":"Test store resolution strategy:\n- Filename-first resolution\n- Registry lookup fallback\n- Unresolved fallback with store_identifiers(kind='unresolved')\n- Test across different chain formats","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:46:48.93219+01:00","created_by":"damir","updated_at":"2025-12-29T19:46:48.93219+01:00","labels":["phase6","testing"],"dependencies":[{"issue_id":"main-4mn.30","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:46:48.934658+01:00","created_by":"daemon"},{"issue_id":"main-4mn.30","depends_on_id":"main-4mn.27","type":"blocks","created_at":"2025-12-29T19:48:17.003823+01:00","created_by":"daemon"}]}
{"id":"main-4mn.31","title":"Create Cloudflare Worker for ingestion","description":"Create src/ingestion/worker.ts:\n- Queue consumer for parse_entry messages\n- Cron scheduled handler for discover+fetch\n- Handle QueueMessage types:\n  - expand_zip: run_id, file_id\n  - parse_entry: run_id, entry_id, chain_id\n- Batch parse + persist","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:47:14.32944+01:00","created_by":"damir","updated_at":"2025-12-29T19:47:14.32944+01:00","labels":["cloudflare","phase7"],"dependencies":[{"issue_id":"main-4mn.31","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:47:14.332271+01:00","created_by":"daemon"},{"issue_id":"main-4mn.31","depends_on_id":"main-4mn.6","type":"blocks","created_at":"2025-12-29T19:48:17.979169+01:00","created_by":"daemon"},{"issue_id":"main-4mn.31","depends_on_id":"main-4mn.11","type":"blocks","created_at":"2025-12-29T19:48:18.013409+01:00","created_by":"daemon"}]}
{"id":"main-4mn.32","title":"Update wrangler.jsonc for Queue and R2","description":"Update wrangler.jsonc:\n- Add queue producer: INGESTION_QUEUE → price-ingestion\n- Add queue consumer: max_batch_size: 10, max_retries: 3\n- Add R2 bucket: DATA_BUCKET → kosarica-data\n- Configure cron triggers","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:47:16.607282+01:00","created_by":"damir","updated_at":"2025-12-29T19:47:16.607282+01:00","labels":["cloudflare","phase7"],"dependencies":[{"issue_id":"main-4mn.32","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:47:16.609488+01:00","created_by":"daemon"},{"issue_id":"main-4mn.32","depends_on_id":"main-4mn.31","type":"blocks","created_at":"2025-12-29T19:48:18.048271+01:00","created_by":"daemon"}]}
{"id":"main-4mn.33","title":"Test ZIP fanout with Queue","description":"Test Cloudflare Queue fanout:\n- ZIP with multiple entries\n- Verify entries enqueued as parse_entry messages\n- Verify parallel processing\n- Check backpressure and retry behavior","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T19:47:17.826935+01:00","created_by":"damir","updated_at":"2025-12-29T19:47:17.826935+01:00","labels":["cloudflare","phase7"],"dependencies":[{"issue_id":"main-4mn.33","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:47:17.829296+01:00","created_by":"daemon"},{"issue_id":"main-4mn.33","depends_on_id":"main-4mn.31","type":"blocks","created_at":"2025-12-29T19:48:18.082775+01:00","created_by":"daemon"}]}
{"id":"main-4mn.34","title":"Add npm dependencies for ingestion","description":"Update package.json with new dependencies:\n- fast-xml-parser (XML parsing)\n- xlsx (XLSX parsing)\n- adm-zip (ZIP extraction)\n- iconv-lite (encoding conversion)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T19:47:26.014527+01:00","created_by":"damir","updated_at":"2025-12-30T11:15:38.020455527Z","closed_at":"2025-12-30T11:15:38.020455527Z","close_reason":"Added all 4 dependencies: fast-xml-parser, xlsx, adm-zip, iconv-lite","labels":["phase1","setup"],"dependencies":[{"issue_id":"main-4mn.34","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:47:26.017634+01:00","created_by":"daemon"}]}
{"id":"main-4mn.4","title":"Create storage abstraction","description":"Create src/ingestion/core/storage.ts:\n- Abstraction over local FS and Cloudflare R2\n- Store/retrieve files by key\n- Compute SHA256 for dedup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:44:29.826339+01:00","created_by":"damir","updated_at":"2025-12-30T13:32:06.465553487Z","closed_at":"2025-12-30T13:32:06.465553487Z","close_reason":"Created storage.ts with Storage interface, LocalStorage (FS), R2Storage (CF Workers), computeSha256, and utility functions","labels":["core","phase2"],"dependencies":[{"issue_id":"main-4mn.4","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:44:29.829083+01:00","created_by":"daemon"},{"issue_id":"main-4mn.4","depends_on_id":"main-4mn.1","type":"blocks","created_at":"2025-12-29T19:47:50.126383+01:00","created_by":"daemon"}]}
{"id":"main-4mn.5","title":"Create normalization utilities","description":"Create src/ingestion/core/normalize.ts:\n- Decimal styles: 3,69 → 3.69, ,69 → 0.69\n- Quantity formats: '315 G' → {value: 315, unit: 'G'}\n- Pack notation: '6x500ml' → {pack_count: 6, pack_unit_value: 500, pack_unit_unit: 'ML'}\n- Barcode cleanup: remove spaces, quotes, Excel quoting","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:44:31.003811+01:00","created_by":"damir","updated_at":"2025-12-30T13:36:42.944104901Z","closed_at":"2025-12-30T13:36:42.944104901Z","close_reason":"Created normalize.ts with decimal, quantity, pack, and barcode normalization utilities","labels":["core","phase2"],"dependencies":[{"issue_id":"main-4mn.5","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:44:31.006331+01:00","created_by":"daemon"},{"issue_id":"main-4mn.5","depends_on_id":"main-4mn.1","type":"blocks","created_at":"2025-12-29T19:47:50.165985+01:00","created_by":"daemon"}]}
{"id":"main-4mn.6","title":"Create persist module with signature dedup","description":"Create src/ingestion/core/persist.ts:\n- Upsert stores, retailer_items, retailer_item_barcodes\n- Compute price_signature hash\n- If signature unchanged: update last_seen_ts only\n- If signature changed: close old period, open new period\n- Insert to store_item_price_periods only on change","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:44:32.544076+01:00","created_by":"damir","updated_at":"2025-12-30T13:44:07.709663089Z","closed_at":"2025-12-30T13:44:07.709663089Z","close_reason":"Created src/ingestion/core/persist.ts with: computePriceSignature for SHA256 hash of price fields, upsertRetailerItem with chain+externalId/name lookup, syncBarcodes for deduped barcode sync, persistPrice with signature dedup (updates last_seen_at if unchanged, closes old period and opens new if changed), persistRows batch function, and persistRowsForStore convenience function","labels":["core","phase2"],"dependencies":[{"issue_id":"main-4mn.6","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:44:32.547218+01:00","created_by":"daemon"},{"issue_id":"main-4mn.6","depends_on_id":"main-4mn.1","type":"blocks","created_at":"2025-12-29T19:47:50.201372+01:00","created_by":"daemon"},{"issue_id":"main-4mn.6","depends_on_id":"main-4mn.3","type":"blocks","created_at":"2025-12-29T19:47:51.708077+01:00","created_by":"daemon"}]}
{"id":"main-4mn.7","title":"Create base parser interface","description":"Create src/ingestion/parsers/base.ts:\n- Abstract Parser class/interface\n- parse(content: Buffer, options: ParseOptions) → NormalizedRow[]\n- Common error handling","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:44:56.55452+01:00","created_by":"damir","updated_at":"2025-12-30T13:48:18.9336486Z","closed_at":"2025-12-30T13:48:18.9336486Z","close_reason":"Created src/ingestion/parsers/base.ts with abstract Parser class, ParseContext interface, ParserRegistry, and common utilities for error/warning handling, content decoding, and row validation","labels":["parsers","phase3"],"dependencies":[{"issue_id":"main-4mn.7","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:44:56.557012+01:00","created_by":"daemon"},{"issue_id":"main-4mn.7","depends_on_id":"main-4mn.3","type":"blocks","created_at":"2025-12-29T19:48:01.184795+01:00","created_by":"daemon"}]}
{"id":"main-4mn.8","title":"Create CSV parser","description":"Create src/ingestion/parsers/csv.ts:\n- Configurable delimiter (comma, semicolon, tab)\n- Handle different encodings (utf-8, windows-1250)\n- Return NormalizedRow[]","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:44:58.042047+01:00","created_by":"damir","updated_at":"2025-12-30T14:03:35.954062838Z","closed_at":"2025-12-30T14:03:35.954062838Z","close_reason":"Closed","labels":["parsers","phase3"],"dependencies":[{"issue_id":"main-4mn.8","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:44:58.044236+01:00","created_by":"daemon"},{"issue_id":"main-4mn.8","depends_on_id":"main-4mn.7","type":"blocks","created_at":"2025-12-29T19:48:01.225085+01:00","created_by":"daemon"}]}
{"id":"main-4mn.9","title":"Create XML parser","description":"Create src/ingestion/parsers/xml.ts:\n- Use fast-xml-parser\n- Handle Studenac/Trgocentar XML formats\n- Extract store blocks from XML content","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:44:58.983067+01:00","created_by":"damir","updated_at":"2025-12-30T14:10:10.211549429Z","closed_at":"2025-12-30T14:10:10.211549429Z","close_reason":"Implemented XML parser using fast-xml-parser with configurable field mapping","labels":["parsers","phase3"],"dependencies":[{"issue_id":"main-4mn.9","depends_on_id":"main-4mn","type":"parent-child","created_at":"2025-12-29T19:44:58.985332+01:00","created_by":"daemon"},{"issue_id":"main-4mn.9","depends_on_id":"main-4mn.7","type":"blocks","created_at":"2025-12-29T19:48:01.262345+01:00","created_by":"daemon"}]}
{"id":"main-5fm","title":"Another Test [feature, P1]","description":"Description with priority and type","acceptance_criteria":"- [ ] Test criterion","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-29T19:42:59.659742+01:00","updated_at":"2025-12-29T19:43:07.652074+01:00","deleted_at":"2025-12-29T19:43:07.652074+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"main-gu4","title":"Another Test","description":"type: feature","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-29T19:43:07.743867+01:00","updated_at":"2025-12-29T19:43:17.625779+01:00","deleted_at":"2025-12-29T19:43:17.625779+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"main-ppu","title":"Test Issue Title","description":"Description here","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-29T19:42:50.188537+01:00","updated_at":"2025-12-29T19:43:07.650859+01:00","deleted_at":"2025-12-29T19:43:07.650859+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
